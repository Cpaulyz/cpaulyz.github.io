<!doctype html><html lang=en-us><head><title>MIT6.824 Lecture6 Raft-1 | ChenYZ</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Lecture6 Raft(1) 讲义：http://nil.csail.mit.edu/6.824/2020/notes/l-raft.txt 视频：https://ww"><meta name=generator content="Hugo 0.64.0"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/images/favicon.ico type=image/x-icon><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','your-google-analytics-id','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css integrity=sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js integrity=sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8 crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js integrity=sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl crossorigin=anonymous onload=renderMathInElement(document.body);></script></head><body><nav class=navigation><a href=/><span class=arrow>←</span>Home</a>
<a href=/posts>Archive</a>
<a href=/tags>Tags</a>
<a href=/about>About</a>
<a class=button href=/index.xml>Subscribe</a></nav><main class=main><section id=single><h1 class=title>MIT6.824 Lecture6 Raft-1</h1><div class=tip><time datetime="2022-02-01 00:00:00 +0000 UTC">Feb 1, 2022</time>
<span class=split>·</span>
<span>wordCount</span>
<span class=split>·</span>
<span>4 minute read</span></div><aside class=toc><details><summary>Table of Contents</summary><div><nav id=TableOfContents><ul><li><a href=#脑裂split-brain>脑裂（Split-Brain）</a></li><li><a href=#过半投票majority-vote>过半投票（Majority Vote）</a></li><li><a href=#raft>Raft</a><ul><li><a href=#log>Log</a></li><li><a href=#leader>Leader</a></li></ul></li></ul></nav></div></details></aside><div class=content><h1 id=lecture6-raft1>Lecture6 Raft(1)</h1><blockquote><p>讲义：http://nil.csail.mit.edu/6.824/2020/notes/l-raft.txt</p><p>视频：https://www.bilibili.com/video/BV1R7411t71W?p=6</p><p>参考笔记：https://mit-public-courses-cn-translatio.gitbook.io/mit6-824/lecture-06-raft1</p><p>对应raft论文前五章</p></blockquote><h2 id=脑裂split-brain>脑裂（Split-Brain）</h2><p>之前学习的系统</p><ul><li>MapReduce 依靠单一的master来复制计算</li><li>GFS master来决定数据备份</li><li>VM-FT，primary&backup，出现故障时以来单机的test-and-set服务</li></ul><p>它们存在一个共性：它们需要一个单节点来决定，在多个副本中，谁是主（Primary）。</p><ul><li>好处：单节点不可能否认自己，它的决策就是整体的决策。</li><li>缺点：可能出现单点故障（Single Point of Failure）。</li></ul><p>使用单点更重要原因是，可以有效<strong>避免脑裂（Split-Brain）</strong></p><p>脑裂会导致一些问题，比如在以下的网络拓扑中，s1、s2是两个test-and-set服务，我们要求能够容错</p><p></p><p>假设网络出现故障，c1只能和s1通信，c2只能和s2通信</p><p></p><p>要么等待两个服务器响应，那么这个时候就没有容错能力；</p><p>要么只等待一个服务器响应，那么就会进入错误的场景（c1、c2都能拿到锁），而这种错误的场景，通常被称为脑裂。</p><p>这是上世纪80年代之前要面临的挑战。当时有多副本系统的要求。例如，控制电话交换机的计算机系统，或者是运行银行系统的计算机系统。当时的人们在构建多副本系统时，需要排除脑裂的可能。这里有两种技术：</p><ul><li>第一种是构建一个不可能出现故障的网络。当网络不出现故障时，那就意味着，如果客户端不能与一个服务器交互，那么这个服务器肯定是关机了。</li><li>另一种就是人工解决问题。默认情况下，客户端总是要等待两个服务器响应，如果只有一个服务器响应，永远不要执行任何操作。相应的，给运维人员打电话，让运维人员去机房检查两个服务器。要么将一台服务器直接关机，要么确认一下其中一台服务器真的关机了，而另一个台还在工作。所以本质上，这里把人作为了一个决策器。而如果把人看成一台电脑的话，那么这个人他也是个单点。</li></ul><p>这些方案都有缺陷，因为人工响应不能很及时，而不出现故障的网络又很贵，但是这些方法至少是可行的</p><h2 id=过半投票majority-vote>过半投票（Majority Vote）</h2><p>如果想要自动解决脑裂问题，一个关键思路就是过半投票。</p><ul><li><p>要求：服务器的数量要是奇数，而不是偶数。6.1的例子中，中间出现故障，那两边就太过对称，它们看起来完全是一样的，它们运行了同样的软件，所以它们也会做相同的事情，这样不太好（会导致脑裂）。</p></li><li><p>思路：<strong>如果系统有 2 * F + 1 个服务器，那么系统最多可以接受F个服务器出现故障，仍然可以正常工作。</strong></p></li></ul><blockquote><p>过半指的是所有服务器数量的一半，而不是当前开机服务器数量的一半</p></blockquote><p>这样的系统通常被称为多数投票（quorum）系统。</p><h2 id=raft>Raft</h2><p>详见raft论文阅读与lab实现～</p><h3 id=log>Log</h3><p>Log的作用：</p><ul><li>用来对操作排序的一种手段</li><li>Followe收到了操作，但是还没有执行操作时，需要将这个操作存放在某处，直到收到了Leader发送的新的commit号才执行</li><li>Leader需要在它的Log中记录操作，因为这些操作可能需要重传给Follower</li><li>帮助重启的服务器恢复状态</li></ul><h3 id=leader>Leader</h3><p>为什么需要leader？</p><p>通常情况下，如果服务器不出现故障，有一个Leader的存在，会使得整个系统更加高效。因为有了一个大家都知道的指定的Leader，对于一个请求，你可以只通过一轮消息就获得过半服务器的认可。对于一个无Leader的系统，通常需要一轮消息来确认一个临时的Leader，之后第二轮消息才能确认请求。</p><p>每个term<strong>至多</strong>有一个leader</p></div><div class=tags><a href=tags/mit6.824>MIT6.824</a>
<a href=tags/distributed-system>distributed system</a></div></section></main><footer id=footer><div id=social><a class=symbol href=https://github.com/Cpaulyz rel=me target=_blank><svg fill="#bbb" width="28" height="28" viewBox="0 0 72 72" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>Github</title><desc>Created with Sketch.</desc><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Social-Icons---Rounded-Black" transform="translate(-264.000000, -939.000000)"><g id="Github" transform="translate(264.000000, 939.000000)"><path d="M8 72H64C68.418278 72 72 68.418278 72 64V8c0-4.418278-3.581721999999999-8-8-8H8c-4.418278 811624501e-24-8 3.581722-8 8V64C541083001e-24 68.418278 3.581722 72 8 72z" id="Rounded" fill="#bbb"/><path d="M35.9985 13C22.746 13 12 23.7870921 12 37.096644 12 47.7406712 18.876 56.7718301 28.4145 59.9584121 29.6145 60.1797862 30.0525 59.4358488 30.0525 58.7973276 30.0525 58.2250681 30.0315 56.7100863 30.0195 54.6996482 23.343 56.1558981 21.9345 51.4693938 21.9345 51.4693938 20.844 48.6864054 19.2705 47.9454799 19.2705 47.9454799 17.091 46.4500754 19.4355 46.4801943 19.4355 46.4801943 21.843 46.6503662 23.1105 48.9634994 23.1105 48.9634994 25.2525 52.6455377 28.728 51.5823398 30.096 50.9649018 30.3135 49.4077535 30.9345 48.3460615 31.62 47.7436831 26.2905 47.1352808 20.688 45.0691228 20.688 35.8361671 20.688 33.2052792 21.6225 31.0547881 23.1585 29.3696344 22.911 28.7597262 22.0875 26.3110578 23.3925 22.9934585 23.3925 22.9934585 25.4085 22.3459017 29.9925 25.4632101 31.908 24.9285993 33.96 24.6620468 36.0015 24.6515052 38.04 24.6620468 40.0935 24.9285993 42.0105 25.4632101 46.5915 22.3459017 48.603 22.9934585 48.603 22.9934585 49.9125 26.3110578 49.089 28.7597262 48.8415 29.3696344 50.3805 31.0547881 51.309 33.2052792 51.309 35.8361671 51.309 45.0917119 45.6975 47.1292571 40.3515 47.7256117 41.2125 48.4695491 41.9805 49.9393525 41.9805 52.1877301 41.9805 55.4089489 41.9505 58.0067059 41.9505 58.7973276 41.9505 59.4418726 42.3825 60.1918338 43.6005 59.9554002 53.13 56.7627944 60 47.7376593 60 37.096644 60 23.7870921 49.254 13 35.9985 13" fill="#fff"/></g></g></g></svg></a></div><div class=copyright>© Copyright
2022
<span class=split><svg fill="#bbb" width="15" height="15" id="heart-15" xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 15 15"><path d="M13.91 6.75c-1.17 2.25-4.3 5.31-6.07 6.94-.1903.1718-.4797.1718-.67.0C5.39 12.06 2.26 9 1.09 6.75-1.48 1.8 5-1.5 7.5 3.45 10-1.5 16.48 1.8 13.91 6.75z"/></svg></span>cpaulyz</div><div class=powerby>Powered by <a href=http://www.gohugo.io/>Hugo</a> Theme By <a href=https://github.com/nodejh/hugo-theme-cactus-plus>nodejh</a></div></footer></body></html>